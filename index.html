<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Distribution Service</title>
    <link rel="stylesheet" href="styles.css">
    <!-- لینک به کتابخانه Uploadcare -->
    <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js" charset="utf-8"></script>
    
    <!-- تنظیم API Key -->
    <script>
        UPLOADCARE_PUBLIC_KEY = "a7b9d76091952310f787";  <!-- Public Key -->
    </script>
    
    <style>
        form {
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 10px;
        }

        input[type="text"], input[type="date"], input[type="url"], input[type="file"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .upload-section {
            margin-bottom: 40px;
        }
    </style>
</head>
<body>

    <header>
        <h1>Music Distribution Service</h1>
        <p>Please fill in the required information and upload your files</p>
    </header>

    <main>
        <!-- شروع فرم -->
        <form name="music-distribution" method="POST" action="https://formspree.io/f/xpwzwdjl" enctype="multipart/form-data">
            <input type="hidden" name="form-name" value="music-distribution">
            
            <section>
                <h2>Artist Information</h2>
                <label for="artist-name">Artist Name:</label>
                <input type="text" id="artist-name" name="artist-name" required>

                <label for="legal-name">Legal Name:</label>
                <input type="text" id="legal-name" name="legal-name" required>

                <label for="dob">Date of Birth (YYYY-MM-DD):</label>
                <input type="date" id="dob" name="dob" required>

                <label for="spotify">Spotify Link:</label>
                <input type="url" id="spotify" name="spotify">

                <label for="apple-music">Apple Music Link:</label>
                <input type="url" id="apple-music" name="apple-music">
            </section>

            <section>
                <h2>Music Information</h2>
                <label for="track-name">Track Name:</label>
                <input type="text" id="track-name" name="track-name" required>

                <label for="composer-name">Composer Name (Artist's Full Legal Name):</label>
                <input type="text" id="composer-name" name="composer-name" required>

                <label for="producer-name">Producer Name:</label>
                <input type="text" id="producer-name" name="producer-name">

                <label for="mixing-engineer">Mixing Engineer:</label>
                <input type="text" id="mixing-engineer" name="mixing-engineer">

                <label for="mastering-engineer">Mastering Engineer:</label>
                <input type="text" id="mastering-engineer" name="mastering-engineer">
            </section>

            <!-- بخش آپلود کاور -->
            <section class="upload-section">
                <h2>Upload Cover Image</h2>
                <label for="cover-art">Upload Cover Image (JPG 3000x3000):</label>
                <input type="hidden" role="uploadcare-uploader" id="cover-art" name="cover-art" data-crop="3000x3000" required>
            </section>

            <!-- بخش آپلود فایل WAV -->
            <section class="upload-section">
                <h2>Upload WAV File</h2>
                <label for="music-track">Upload WAV File:</label>
                <input type="hidden" role="uploadcare-uploader" id="music-track" name="music-track" accept=".wav" required>
            </section>

            <button type="submit">Submit</button>
        </form>
        <!-- پایان فرم -->
    </main>

    <script>
        document.querySelector('form').addEventListener('submit', function(event) {
            event.preventDefault();

            // دریافت Track Name از فرم
            var trackName = document.getElementById('track-name').value;

            // آپلود کاور با مسیر کاستوم
            var coverUploader = uploadcare.Widget('[role=uploadcare-uploader]#cover-art');
            coverUploader.onUploadComplete(function(fileInfo) {
                var fileUUID = fileInfo.uuid;
                var filePath = '/' + trackName + '/cover.jpg';  // مسیر کاستوم با نام Track Name

                // آپلود به مسیر کاستوم
                uploadcare.fileFrom('uploaded', fileUUID).done(function(file) {
                    file.store();
                    file.setMetadata('path', filePath);
                });
            });

            // آپلود فایل WAV با مسیر کاستوم
            var wavUploader = uploadcare.Widget('[role=uploadcare-uploader]#music-track');
            wavUploader.onUploadComplete(function(fileInfo) {
                var fileUUID = fileInfo.uuid;
                var filePath = '/' + trackName + '/track.wav';  // مسیر کاستوم با نام Track Name

                // آپلود به مسیر کاستوم
                uploadcare.fileFrom('uploaded', fileUUID).done(function(file) {
                    file.store();
                    file.setMetadata('path', filePath);
                });
            });

            // ارسال فرم بعد از آپلود
            setTimeout(function() {
                event.target.submit();
            }, 3000); // این تأخیر برای اطمینان از اتمام آپلود فایل‌هاست
        });
    </script>

</body>
</html>
